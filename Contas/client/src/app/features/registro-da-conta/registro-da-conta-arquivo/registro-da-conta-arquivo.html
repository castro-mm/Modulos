<p-panel header="Arquivos da Conta">
    <div class="row mt-2">
        <div class="col-3">
            <label for="modalidadeDoArquivo" class="mb-1">Modalidade de Arquivo:</label>
                <p-select
                [ngModel]="modalidadeDoArquivo()"
                (ngModelChange)="modalidadeDoArquivo.set($event)"
                [options]="modalidadeDoArquivoOptions"
                optionLabel="label" 
                optionValue="value" 
                appendTo="body"
                placeholder="Selecione..."
                fluid
            />
        </div>
        <div class="col-9">            
            <label class="mb-1">Arquivo:</label>
            <app-upload 
                [disabled]="!modalidadeDoArquivoSelected()" 
                (uploadResult)="onUploadResult($event)"
            />
        </div>
    </div>  
    <div class="row mt-2">
        <div class="col-12">
            <p-table 
                #dt
                [paginator]="true"                 
                [rows]="5"
                [value]="listaDeArquivosDoRegistroDaConta()"
                size="small"
                stripedRows="true"
            >
                <ng-template pTemplate="header">
                    <tr>
                        <th>Nome</th>
                        <th>Modalidade</th>
                        <th>Tipo</th>
                        <th>Tamanho</th>
                        <th>Data de Atualização</th>
                        <th>Data de Modificação</th>
                        <th></th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-item>
                    <tr>
                        <td>{{ item.arquivo.nome }}{{ item.arquivo.extensao }}</td>
                        <td>{{ item.modalidadeDoArquivo }}</td>
                        <td>{{ item.arquivo.tipo }}</td>
                        <td>{{ item.arquivo.tamanho | fileSize : 2 }}</td>
                        <td>{{ item.dataDeAtualizacao | date:'dd/MM/yyyy HH:mm:ss' }}</td>
                        <td>{{ item.arquivo.dataDaUltimaModificacao | date:'dd/MM/yyyy HH:mm:ss' }}</td>
                        <td style="text-align: right;">
                            <p-button class="mr-2" icon="pi pi-eye" severity="help" outlined (click)="visualizarArquivo(item.arquivo)" pTooltip="Visualizar"/>
                            <p-button class="mr-2" icon="pi pi-download" severity="success" outlined (click)="baixarArquivo(item.arquivo)" pTooltip="Download"/>
                            <p-button icon="pi pi-trash" severity="danger" outlined (click)="excluirArquivo(item.arquivo)" pTooltip="Excluir" />
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                      <td colspan="7" class="text-center">
                        <div class="empty-message">
                          <i class="pi pi-inbox" style="font-size: 3rem; color: #ccc;"></i>
                          <p>Nenhum arquivo encontrado</p>
                        </div>
                      </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>    
</p-panel>
<!--Pode ser provisorio, se funcionar o output dos parametros para o detail-->
<p-dialog 
    header="Visualizar Arquivo" 
    [(visible)]="exibirDialog" 
    [modal]="true" 
    [style]="{width: '90vw', height: '90vh'}" 
    [contentStyle]="{height: 'calc(100% - 60px)', overflow: 'hidden'}"
    [closable]="false"
    [maximizable]="true"
>
    @if (visualizacaoConfig!.isImagem) {
        <div style="width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; overflow: auto;">
            <img [src]="visualizacaoConfig!.urlArquivo" alt="Imagem do Arquivo" style="max-width: 100%; max-height: 100%; object-fit: contain;" />
        </div>    
    } @else {
        <div style="width: 100%; height: 100%;">
            <iframe [src]="visualizacaoConfig!.urlArquivo | safeUrl: 'resourceUrl'" style="width: 100%; height: 100%; border: none;"></iframe>
        </div>
    }
    <ng-template pTemplate="footer">
        <div class="col-10" style="text-align: right;">
            <p-button label="Baixar" icon="pi pi-download" severity="success" (click)="baixarArquivo(visualizacaoConfig!.arquivoSelecionado)" class="mr-2"></p-button>
            <p-button label="Excluir" icon="pi pi-trash" severity="danger" (click)="excluirArquivo(visualizacaoConfig!.arquivoSelecionado)" class="mr-2"></p-button>    
            <p-button label="Fechar" icon="pi pi-times" severity="secondary" (click)="inicializaEstadoDoComponente()"></p-button>
        </div>
    </ng-template>
</p-dialog>