<div class="container-fluid">
    <form #f [formGroup]="form" (submit)="salvar()">
        <p-divider class="mt-1" />
        <div class="row mt-2">
            <div class="col-2">
                <label for="mes" class="mb-1">{{fieldsLabels['mes']}}:</label>
                <p-select 
                    formControlName="mes" 
                    inputId="mes" 
                    [options]="mesOptions"
                    optionLabel="label" 
                    optionValue="value" 
                    appendTo="body"
                    placeholder="Selecione..."
                    fluid 
                    required
                    autofocus="true"
                />
                <app-field-validation-message [control]="form.get('mes')" [label]="fieldsLabels['mes']" />
            </div>
            <div class="col-2">
                <label for="ano" class="mb-1">{{fieldsLabels['ano']}}:</label>
                <p-select 
                    formControlName="ano" 
                    inputId="ano" 
                    [options]="anoOptions"
                    optionValue="value" 
                    optionLabel="label" 
                    appendTo="body"
                    placeholder="Selecione..."
                    fluid 
                    required
                />
                <app-field-validation-message [control]="form.get('ano')" [label]="fieldsLabels['ano']" />
            </div>            
        </div>
        <div class="row mt-2">
            <div class="col-6">
                <label for="credorId" class="mb-1">{{fieldsLabels['credorId']}}:</label>
                <p-select 
                    formControlName="credorId" 
                    inputId="credor" 
                    [options]="credorOptions"
                    optionLabel="label" 
                    optionValue="value" 
                    appendTo="body"
                    placeholder="Selecione..."
                    [filter]="true" 
                    filterBy="label"
                    fluid
                >
                    <ng-template #footer>
                        <div class="p-2">
                            <p-button label="Novo" fluid severity="success" outlined icon="pi pi-plus" (click)="abrirModalDoCredor()" />
                        </div>
                    </ng-template>                
                </p-select>
                <app-field-validation-message [control]="form.get('credorId')" [label]="fieldsLabels['credorId']" />
            </div>
        </div>            
        <div class="row mt-2">
            <div class="col-4">
                <label for="pagadorId" class="mb-1">{{fieldsLabels['pagadorId']}}:</label>
                <p-select 
                    formControlName="pagadorId" 
                    inputId="pagador" 
                    [options]="pagadorOptions"
                    optionLabel="label" 
                    optionValue="value" 
                    appendTo="body"
                    placeholder="Selecione..."
                    [filter]="true" 
                    filterBy="label"
                    fluid
                >
                    <ng-template #footer>
                        <div class="p-2">
                            <p-button label="Novo" fluid severity="success" outlined icon="pi pi-plus" (click)="abrirModalDoPagador()" />
                        </div>
                    </ng-template>                
                </p-select>
                <app-field-validation-message [control]="form.get('pagadorId')" [label]="fieldsLabels['pagadorId']" />
            </div>
        </div>               
        <div class="row mt-2">
            <div class="col-6">
                <label for="codigoDeBarras" class="mb-1">{{fieldsLabels['codigoDeBarras']}}:</label>
                <input 
                    id="codigoDeBarras" 
                    formControlName="codigoDeBarras" 
                    pInputText 
                    required 
                    fluid
                    (input)="onCodigoDeBarrasChange($event)"
                    (blur)="formatarCodigoDeBarras()" 
                />
                <app-field-validation-message [control]="form.get('codigoDeBarras')" [label]="fieldsLabels['codigoDeBarras']" />
                @if (codigoDeBarrasInfo() && codigoDeBarras()) {
                    @if (!codigoDeBarrasInfo()!.valido) {
                        <div class="mt-1">
                            <p-message severity="error" variant="simple">✗ {{codigoDeBarrasInfo()!.mensagem}}</p-message>
                        </div>
                    }
                }                
            </div>
            <div class="col-3">
                <label for="dataDeVencimento" class="mb-1">{{fieldsLabels['dataDeVencimento']}}:</label>
                <p-datepicker 
                    formControlName="dataDeVencimento" 
                    inputId="dataDeVencimento" 
                    dateFormat="dd/mm/yy"
                    showIcon
                    iconDisplay="input"
                    [showButtonBar]="true"
                    [todayButtonStyleClass]="'p-button-text'"
                    [clearButtonStyleClass]="'p-button-text'"
                    fluid
                    required
                />
                <app-field-validation-message [control]="form.get('dataDeVencimento')" [label]="fieldsLabels['dataDeVencimento']" />
            </div>
            <div class="col-3">
                <label for="dataDePagamento" class="mb-1">{{fieldsLabels['dataDePagamento']}}:</label>
                <p-datepicker 
                    formControlName="dataDePagamento" 
                    inputId="dataDePagamento" 
                    dateFormat="dd/mm/yy"
                    showIcon
                    iconDisplay="input"
                    [showButtonBar]="true"
                    [todayButtonStyleClass]="'p-button-text'"
                    [clearButtonStyleClass]="'p-button-text'"
                    fluid
                />
            </div>
        </div> 
        <div class="row mt-2">
            <div class="col-3">
                <label for="valor" class="mb-1">{{fieldsLabels['valor']}}:</label>
                <p-inputNumber 
                    formControlName="valor" 
                    mode="currency" 
                    currency="BRL" 
                    locale="pt-BR"
                    [minFractionDigits]="2"
                    [maxFractionDigits]="2"
                    placeholder="R$ 0,00"
                    fluid
                    required
                    (onInput)="onValorChange($event)"
                />                                
                <app-field-validation-message [control]="form.get('valor')" [label]="fieldsLabels['valor']" />
            </div>
            <div class="col-3">
                <label for="valorDosJuros" class="mb-1">{{fieldsLabels['valorDosJuros']}}:</label>
                <p-inputNumber 
                    formControlName="valorDosJuros" 
                    mode="currency" 
                    currency="BRL" 
                    locale="pt-BR"
                    [minFractionDigits]="2"
                    [maxFractionDigits]="2"
                    placeholder="R$ 0,00"
                    fluid
                    (onInput)="onValorDosJurosChange($event)"
                />            
                <app-field-validation-message [control]="form.get('valorDosJuros')" [label]="fieldsLabels['valorDosJuros']" />
            </div>
            <div class="col-3">
                <label for="valorDoDesconto" class="mb-1">{{fieldsLabels['valorDoDesconto']}}:</label>
                <p-inputNumber 
                    formControlName="valorDoDesconto" 
                    mode="currency"     
                    currency="BRL" 
                    [minFractionDigits]="2"
                    [maxFractionDigits]="2"
                    placeholder="R$ 0,00"
                    fluid
                    (onInput)="onValorDoDescontoChange($event)"
                />
                <app-field-validation-message [control]="form.get('valorDoDesconto')" [label]="fieldsLabels['valorDoDesconto']" />
            </div>
            <div class="col-3">
                <label for="valorTotal" class="mb-1">{{fieldsLabels['valorTotal']}}:</label>
                <p-inputNumber 
                    formControlName="valorTotal" 
                    inputId="valorTotal" 
                    mode="currency"     
                    currency="BRL" 
                    locale="pt-BR"
                    [minFractionDigits]="2"
                    [maxFractionDigits]="2"
                    placeholder="0,00"
                    fluid
                    required
                />
                <app-field-validation-message [control]="form.get('valorTotal')" [label]="fieldsLabels['valorTotal']" />
            </div>
        </div>        
        <div class="row mt-2">
            <div class="col-12">
                <label for="observacoes" class="mb-1">{{fieldsLabels['observacoes']}}:</label>
                <textarea 
                    id="observacoes" 
                    formControlName="observacoes" 
                    pInputTextarea 
                    rows="4" 
                    cols="20"
                    fluid>
                </textarea>
            </div>
        </div>
        @if (entity() !== null) {
            <div class="mt-2">
                <app-registro-da-conta-arquivo [registroDaContaId]="entity()!.id" (uploadResult)="onUploadResult($event)" />
            </div>
            <p-divider class="mt-3" />
            <div class="row mt-2">
                <div class="col-2">
                    <div>
                        <label class="mb-1">Data de Criação: </label>
                        <p>{{ entity()?.dataDeCriacao | date:'dd/MM/yyyy HH:mm:ss' }}</p>
                    </div>            
                </div>
                <div class="col-2">
                    <div>
                        <label class="mb-1">Última Atualização: </label>
                        <p>{{ entity()?.dataDeAtualizacao | date:'dd/MM/yyyy HH:mm:ss' }}</p>
                    </div>            
                </div>
            </div>    
        }
        <p-divider class="mt-3" />
        <div class="row mt-2">
            <div class="col-12 text-end">
                <p-button icon="pi pi-times" label="Fechar" class="me-2" text (click)="closeDialog()"/>
                <p-button icon="pi pi-check" [label]="isLoading ? 'Executando...' : 'Salvar'" [loading]="isLoading" type="submit" [disabled]="form.invalid || isLoading"/>
            </div>    
        </div>
    </form>    
</div>
